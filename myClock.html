<!DOCTYPE html>
<html>
<head>
	<title>MVC Clock</title>
</head>
<body>
	<style>
		body{
			margin: 0 auto;
			text-align:center;
			width:90%;
			
		}

		input {
		margin: 3px 5px 10px;
		}

		canvas {
			display: block;
			width: 300px;
			height: 300px;
			border: 15px solid #FFF999;
			background-color: #FFF000;
			border-radius: 165px; /* 165pxx */

		}
		.time {
			width: 330px;
			height: 380px;
			color: white;
			background-color: #7A9E7A;
			display: inline-block;
			text-align: center;
			border: 2px solid black;
			padding: 10px;
			margin: 5px;
		}
		
		.clockFace {
			position: relative;
			background-color: #FFF540;
			width: 300px;
			height: 300px;
			border-radius: 165px; /* 165pxx */
			border: 15px solid #FFF983;
			z-index: 1;
		}
		.round { 
			position: absolute;
			background-color: #0F613A;
			width : 40px;
			height: 40px;
			border-radius:20px;
			z-index: 2;
		}
		.num {
			position: absolute;
			font-size: 15px;
			font-family: sans-serif;
			color: #7A9E7A;
		}
		.hourHand {
			width: 8px;
			height: 85px;
			border-radius: 4px;
			z-index: 3;
			background-color: #0C2217;
			position: absolute;
			transform-origin: 4px 75px;
		}
		.minuteHand{
			width: 6px;
			height: 110px;
			border-radius: 3px;
			z-index: 4;
			background-color: #0C2217;
			position: absolute;
			transform-origin: 3px 100px;
		}
		.secondHand{
			width: 2px;
			height: 135px;
			border-radius: 1px;
			z-index: 4;
			background-color: red;
			position: absolute;
			transform-origin: 1px 125px;
		}
		.digClock{
			position:absolute;
			font-size: 23px;
			color: #072D1A;
			font-family: sans-serif;
			font-weight: bold;
			width: 100px;
			left: 105px;
			top: 60px;
			z-index: 5;
		}
		
	</style>

	<script>
		"use strict";
  
  /*===================================================================================*/
 /*                   					 M O D E L 				    				  */
/*===================================================================================*/
		function Tclock() {
			
  			var myView = null;
  			
/*-----------------------------------
	МЕТОД ИНИЦИАЛИЗАЦИИ MODEL
-----------------------------------*/
       		this.init = function(view) {	
           		myView = view;
           	}
/*-----------------------------------
	МЕТОД ОТРИСОВКИ СТРЕЛОК И 
	ПОЗИЦИОНИРОВАНИЕ В ЦЕНТРЕ
-----------------------------------*/
			this.handPosition = function (hand) {
				hand.style.bottom = 140 + 'px';
				hand.style.left = 150 - parseInt(hand.offsetWidth)/2 + 'px' ;
			}

			this.startClock = function () {	
			// ----------------------- Устанавливаем интервал в 1000 сек
					
					this.begin = setInterval(myView.updateTime,100);
				}
		}
  /*===================================================================================*/
 /*                   				   V I E W  									  */
/*===================================================================================*/

 /*	-------------------		 DOM 	-----------------  */
/*=====================================================*/
		function TclockViewDOM(UTC) {
			var myModel = null;
			var myField = null;
			var container= null;
			var buttonStart = null;
			var buttoStop = null;
			var clockFace = null;	// ---------------------------------------- циферблат
			
			var hourHand = null;
			var minuteHand = null;
			var secondHand = null;

			var digTime = null;

			var UTC = UTC;
/*-----------------------------------
	МЕТОД ИНИЦИАЛИЗАЦИИ MODEL
-----------------------------------*/
			this.init = function (model, field) {
				myModel = model;
				myField = field;
/*-----------------------------------
	МЕТОД СОЗДАНИЯ DIV ЭЛЕМЕНТОВ
-----------------------------------*/
				this.createDiv = function (tag, classN, insert) {  	//---------------- (тег, класс, куда помещаем)
					this.el = document.createElement(tag);
					this.el.className = classN;

					if (classN == 'num') {
						insert.appendChild(this.el);
						return this.el;
					}

					if (insert == '.time') {
					myField.appendChild(this.el);
					return this.el
					}

					myField.querySelector(insert).appendChild(this.el);
					return this.el;
				}

/*-----------------------------------
	МЕТОД ЗЕЛЕНЫХ КРУЖКОВ С НОМЕРАМИ
	ПО ЦИФЕРБЛАТУ
-----------------------------------*/
				this.painTickRound = function () {
					for ( var i=360; i>0; i-=30) {

						var Round = this.createDiv('div','round','.clockFace'); // --- вычисляем угол в радианах ( i + 30 градусов)
						var alfa = i*Math.PI/180; 			// ---------------------- вычислим радиус
						var radius = 145 - Round.offsetWidth/2;	// ------------------ математически высчитаем позицию кружков 	

						Round.style.left = 150 + radius*Math.sin(alfa) - Round.offsetWidth/2  + 'px';
						Round.style.top = 150 - radius*Math.cos(alfa) - Round.offsetHeight/2  + 'px';
						// -------------------------
						// 	 РАССТАВЛЯЕМ НОМЕРА
						var num = this.createDiv('span','num', Round);
						num.innerHTML = i/30 ; 
						num.style.top = parseInt(Round.offsetHeight)/2 - parseInt(num.offsetHeight)/2 + 'px';
						num.style.left = parseInt(Round.offsetWidth)/2 - parseInt(num.offsetWidth)/2 + 'px';
					}
				}

/*-----------------------------------
	СОЗДАЕМ ЭЛЕМЕНТЫ 
------------------------------------*/				
				container = this.createDiv('div','cont', ".time");	//--------------------- создаем container, для часов и кнопок

				buttoStop = this.createDiv('input','butStop','.cont');	//----------------- создаем кнопку "STOP"
				buttoStop.type = 'button';
				buttoStop.value = 'STOP';

				buttonStart = this.createDiv('input','butStart','.cont'); //--------------- создаем кнопку "START"
				buttonStart.type = 'button';
				buttonStart.value = 'START';

				clockFace = this.createDiv('div','clockFace','.cont')	//----------------- создаем циферблат

				this.painTickRound(); // ------------------------------------------ вызываем метод модели (построение зеленых кружочков)

/*-----------------------------------
	СОЗДАЕМ СТРЕЛКИ 
------------------------------------*/	
				hourHand = this.createDiv('div','hourHand','.clockFace'); 		
				myModel.handPosition(hourHand); 	//------------------------------ обращаемся в модель, которая вычисляет позицию стрелки

				minuteHand = this.createDiv('div','minuteHand','.clockFace');
				myModel.handPosition(minuteHand);

				secondHand = this.createDiv('div','secondHand','.clockFace');
				myModel.handPosition(secondHand);

/*-----------------------------------
	СОЗДАЕМ ЭЛЕКТРОННЫЙ ЦИФЕРБЛАТ
------------------------------------*/		
				digTime =  this.createDiv('div','digClock','.clockFace');

/*-----------------------------------
	ЗАПУСКАЕМ ЧАСЫ ПОСЛЕ СРАЗУ
	ОТРИСОВКИ СТРАНИЦЫ
------------------------------------*/				
				myModel.startClock();
			}

			  this.updateTime = function () {
				
				var time = new Date();
				
				var hours = time.getUTCHours() + UTC;
				var minutes = time.getUTCMinutes();
				var seconds = time.getUTCSeconds();
				var millisecont = time.getUTCMilliseconds();

				if (hours >= 24) {
					hours = hours-24;
				}
				
				secondHand.style.transform = 'rotate(' + (seconds  + millisecont/1000)*6 + 'deg)';;
		        minuteHand.style.transform = 'rotate(' + (minutes + 1 / 60 * seconds) * 6 + 'deg)';
		        hourHand.style.transform = 'rotate(' + (hours * 30 + 1 / 12 * (minutes + 1 / 60 * seconds) * 6) + 'deg)';
				
				digTime.innerHTML = strTime(hours, 2) + ':' + strTime(minutes, 2) + ':' + strTime(seconds, 2);
				
				//--------Дополняем строку нулями слева------
				function strTime(val,len) {  
		        	var strVal=val.toString();
		       		while ( strVal.length < len )
		            strVal='0'+strVal;
		       		return strVal;
				}
			}
		}
 /*	-------------------	 	CANVAS 	 	----------------- */
/*=======================================================*/
		function TclockViewCanvas(UTC) {

			var myModel = null;
			var myField = null;
			var context = null;
			var UTC = UTC;
			var container = null;
			var canvas = null;
			var buttoStop = null;
			var buttonStart = null;
/*-----------------------------------
	МЕТОД ИНИЦИАЛИЗАЦИИ MODEL
-----------------------------------*/
			this.init = function(model, field) {
				myModel =  model;
				myField = field;
				myModel.startClock();
				this.createDiv = function (tag, classN, insert) {  	//---------------- (тег, класс, куда помещаем)
					this.el = document.createElement(tag);
					this.el.className = classN;
					if (insert == '.time') {
						myField.appendChild(this.el);
						return this.el
					}
					myField.querySelector(insert).appendChild(this.el);
					return this.el;
				}
/*-----------------------------------
	СОЗДАЕМ КНОПКИ
------------------------------------*/				
				container = this.createDiv('div','cont', '.time');	//--------------------- создаем container, для часов и кнопок

				buttoStop = this.createDiv('input','butStop','.cont');	//----------------- создаем кнопку "STOP"
				buttoStop.type = 'button';
				buttoStop.value = 'STOP';

				buttonStart = this.createDiv('input','butStart','.cont'); //--------------- создаем кнопку "START"
				buttonStart.type = 'button';
				buttonStart.value = 'START';

				canvas =  this.createDiv('canvas','canvas','.cont')
				canvas.height="300";
				canvas.width="300"
			
			}

			this.updateTime = function () {
/*-----------------------------------
	МЕТОД СОЗДАНИЯ Canvas ЦИФЕРБЛАТА
-----------------------------------*/
		    	
		        context = canvas.getContext('2d');
		        context.save();// помещаем текущий контекст в стэк
		       	context.clearRect(0,0,300,300);
				context.translate(150, 150);
				context.scale(1,1);
				context.rotate(-Math.PI/2);

				context.strokeStyle = "black";
				context.fillStyle = "black";
				context.lineWidth = 5;
				context.lineCap = "round";

				context.save();
				context.beginPath();

				for (var i = 0; i < 12; i++) {
	            	context.rotate(Math.PI/6);
					context.moveTo(120,0);
					context.lineTo(130,0);
        		}
				context.stroke();		// ---------------- нарисовали то, что ранее описали
				context.restore();		// ---------------- достаем последний сохраненный контекст из стэка

				context.save();
				
				var time = new Date();
		        var sec = time.getUTCSeconds();
		        var min = time.getUTCMinutes();
		        var hour = time.getUTCHours() + UTC;
/*-----------------------------------
	РИСУЕМ ЧАСОВУЮ СТРЕЛКУ
	(вращая холст)
-----------------------------------*/
				context.strokeStyle = "#0C2217";// цвет контура
				context.fillStyle = "#0C2217";
				context.rotate((Math.PI/6)*hour +
				(Math.PI/360)*min +
				(Math.PI/21600)*sec);
				context.lineWidth = 10;

				context.beginPath();
				context.moveTo(-20,0);
				context.lineTo(80,0);
				context.stroke();
				context.restore();

				context.save();

/*-----------------------------------
	РИСУЕМ МИНУТНУЮ СТРЕЛКУ
-----------------------------------*/				
				context.strokeStyle = "#0C2217"; // ---------------- цвет контура
				context.fillStyle = "#0C2217";
				context.rotate((Math.PI/30*min) + (Math.PI/1800)*sec);
				context.lineWidth = 7;

				context.beginPath();
				context.moveTo(-28,0);
				context.lineTo(112,0);
				context.stroke();
				context.restore();

				context.save();

/*-----------------------------------
	РИСУЕМ МИНУТНУЮ СТРЕЛКУ
-----------------------------------*/					
				context.rotate(sec * Math.PI/30);
				context.strokeStyle = "#D40000";  // --------------- цвет контура
				context.fillStyle = "#D40000";
				context.lineWidth = 3;

				context.beginPath();
				context.moveTo(-30,0);
				context.lineTo(110,0);
				context.stroke();
				context.restore();

				context.restore();
			}
		}
    		

  /*===================================================================================*/
 /*                   			  C O N T R O L L E R  								  */
/*===================================================================================*/

		function TClockController() {

			var myModel = null;
			var myField = null;

			this.init = function (model,field) {
				myModel=model;
				myField=field;

				var buttonStop = myField.querySelector('.butStop');
	            buttonStop.addEventListener('click',this.stopClock);

	 			var buttonStart = myField.querySelector('.butStart');
	            buttonStart.addEventListener('click',this.startClock);
	        }

	        this.stopClock = function () {
	        	clearInterval (myModel.begin);
	        }
	        this.startClock = function () {
	        	clearInterval (myModel.begin);
	        	myModel.startClock();
	        }

 			//
		}
</script>
<div class="time" id="NewYork">Нью-Йорк (GTM-5)</div>
<div class="time" id="London">Лондон (GTM)</div>
<div class="time" id="Tokio">Токио (GTM+9)</div>
<div class="time" id="Vladivostok">Владивосток (GTM+10)</div>

<script>
	var NewYork_M = new Tclock();
	var NewYork_V = new TclockViewDOM(-5);
	var NewYork_C = new TClockController();
	var  NewYorkBox = document.body.querySelector('#NewYork');
	NewYork_M.init(NewYork_V);
	NewYork_V.init(NewYork_M, NewYorkBox);
	NewYork_C.init(NewYork_M, NewYorkBox);

	var London_M = new Tclock();
	var London_V = new TclockViewDOM(0);
	var London_C = new TClockController();
	var  London = document.body.querySelector('#London');
	London_M.init(London_V);
	London_V.init(London_M, London);
	London_C.init(London_M, London);

	var Tokio_M = new Tclock();
	var Tokio_V = new TclockViewCanvas(9);
	var Tokio_C = new TClockController();
	var  Tokio=document.body.querySelector('#Tokio');
	Tokio_M.init(Tokio_V);
	Tokio_V.init(Tokio_M, Tokio);
	Tokio_C.init(Tokio_M, Tokio);

	var Vladivostok_M = new Tclock();
	var Vladivostok_V = new TclockViewCanvas(10);
	var Vladivostok_C = new TClockController();
	var  Vladivostok=document.body.querySelector('#Vladivostok');
	Vladivostok_M.init(Vladivostok_V);
	Vladivostok_V.init(Vladivostok_M, Vladivostok);
	Vladivostok_C.init(Vladivostok_M, Vladivostok);
</script>